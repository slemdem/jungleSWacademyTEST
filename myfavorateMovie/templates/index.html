<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
        crossorigin="anonymous">

	<!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
        
    <!--Font Awesome -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"
    />
   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„</title>

    <style>
        
        .hero{
            background-color: gold;
            height: 200px;
            padding: 50px;
        }

        .center {
            text-align: center;
        }

        .sorter-box {
            width: 550px;
            color: darkcyan;
        }

        .movie-list {
            width: 550px;
            margin: 20px auto 0 auto;
        }

        .movie-title {
            display: inline-block;
        }

        .movie-title:hover {
            text-decoration: underline;
        }

        .card {
            margin-bottom: 15px;
            display: block;
            line-height: 0;
            box-shadow: 1px 1px 3px gray;
        }
        
        .card .row .col-md-3{
            margin: auto;
        }

        .card img{
            margin: auto;
            display: inline-block;
            top: 1px;
            padding: 3%;
            width: 70%;
        }

        .card .card-context{
            display: inline-block;
            line-height: 1;
            width: 64%;
            padding: 2%;
        }

        .card .card-context .movie-title{
            font: bolder;
            font-size: x-large;
        }

        .card .card-context>span{
        }

        .card .card-context>p{
            margin: 20px 0;
        }

        .card .card-footer{
            display: flex;
            width: 100%;
            background-color: rgba(255, 255, 255, 0);
        }
    
        .card .card-footer>a:nth-child(1){
            text-align: center;
            display: inline-block;
            width: 49%;
            color: blue;
            border: left gray 1px;
            background-color: white;
        }
        .card .card-footer>div {
            position:relative;
            left: 0;
            
            content: "";
            width: 1px;
            height: 25px;
            background-color: rgb(187, 187, 187);
        }

        .card .card-footer>a:nth-child(3){
            text-align: center;
            display: inline-block;
            width: 49%;
            color: red;
        }
    </style>

    <!-- Script -->
    <script>
        const Sort = {
        BY_LIKES: "likes",
        BY_VIEWERS: "viewers",
        BY_DATE: "date",
        };

        let sortMode = Sort.BY_LIKES
        let trashMode = false

        // index.html ì˜ ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ready(...) ì•ˆì— ë“±ë¡ëœ í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
        // ì•„ë˜ëŠ” í•¨ìˆ˜ì— ì´ë¦„ì„ ë¶€ì—¬í•˜ì§€ ì•Šê³  ë°”ë¡œ ready(...) ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¡œë“œ ì™„ë£Œì‹œ í˜¸ì¶œë  í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
        $(document).ready(function () {
            // ì˜í™” ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            showMovie()

            // í˜„ì¬ ì ìš©ë˜ê³  ìˆëŠ” ì •ë ¬ ë°©ì‹ì˜ ë²„íŠ¼ì— ëˆŒë ¤ì ¸ ë³´ì´ëŠ” íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤.
            displaySorter()

            // íœ´ì§€í†µ ëª¨ë“œì— ë”°ë¼ ë©”ë‰´ë¥¼ ë‹¤ë¥´ê²Œ ë°”ê¿”ì¤ë‹ˆë‹¤.
            displayTrashMode(trashMode)
        });

        function showMovie() {
            // 1. id="movie-box" ë¡œ ëœ íƒœê·¸ì˜ ë‚´ë¶€ html íƒœê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.
            $('#movie-box').empty()

            // 2. íœ´ì§€í†µì„ ë³´ê³  ìˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ í˜¸ì¶œí•  API ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
            //    íœ´ì§€í†µì´ ì•„ë‹ ê²½ìš° GET /api/list
            //    íœ´ì§€í†µì¼ ê²½ìš° GET /api/list/trash
            if (trashMode == false) {
                $.ajax({
                    type: "GET",
                    url: "/api/list",
                    data: {'sortMode': sortMode},
                    success: function(response) {
                        if (response['result'] != 'success') {
                            alert(sortMode + ' ìˆœìœ¼ë¡œ ì˜í™” ëª©ë¡ ë°›ì•„ì˜¤ê¸° ì‹¤íŒ¨!')
                            return
                        }
                        // 3. ì„œë²„ê°€ ëŒë ¤ì¤€ stars_listë¥¼ movies ë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
                        let movies = response['movies_list']
                        // 4. ì˜í™” ì¹´ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë•Œ íœ´ì§€í†µ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œ ëª¨ì–‘ì´ ë‹¬ë¼ì§€ë¯€ë¡œ íœ´ì§€í†µ ì—¬ë¶€(=false)ë„ ê°™ì´ ì „ë‹¬í•©ë‹ˆë‹¤.
                        addMovieCards(movies, false)
                    },
                })
            } else {
                $.ajax({
                    type: "GET",
                    url: "/api/list/trash",
                    data: {'sortMode': sortMode},
                    success: function(response) {
                        if (response['result'] != 'success') {
                            alert(sortMode + ' ìˆœìœ¼ë¡œ ì˜í™” ëª©ë¡ ë°›ì•„ì˜¤ê¸° ì‹¤íŒ¨!')
                            return
                        }
                        // 3. ì„œë²„ê°€ ëŒë ¤ì¤€ stars_listë¥¼ movies ë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
                        let movies = response['movies_list']
                        // 4. ì˜í™” ì¹´ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë•Œ íœ´ì§€í†µ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œ ëª¨ì–‘ì´ ë‹¬ë¼ì§€ë¯€ë¡œ íœ´ì§€í†µ ì—¬ë¶€(=false)ë„ ê°™ì´ ì „ë‹¬í•©ë‹ˆë‹¤.
                        addMovieCards(movies, true)
                    },
                })
            }
        }

        function addMovieCards(movies, trashMode) {
            // for ë¬¸ì„ í™œìš©í•˜ì—¬ movies ë°°ì—´ì˜ ìš”ì†Œë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
            for (let i = 0; i < movies.length; i++) {
                let movie = movies[i]

                // 1. movie[i] ìš”ì†Œì˜ title,viewers, likes í‚¤ ê°’ì„ í™œìš©í•˜ì—¬ ê°’ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
                let id = movie['_id']
                let title = movie['title']
                let viewers = movie['viewers']
                let poster = movie['poster_url']
                let likes = movie['likes']
                let month = Number(movie['open_month']) 
                let date = Number( movie['open_day'])

                if(month < 10){
                    if(date < 10){
                        date = movie['open_year'] + ".0"+ month + ".0" +date
                    } else{
                        date = movie['open_year'] + ".0"+ month + "." +date
                    }
                }else {
                    if(date < 10){
                        date = movie['open_year'] + "."+ month + ".0" +date
                    } else{
                        date = movie['open_year'] + "."+ month + "." +date
                    }
                }

                // 2. ì˜í™” ì¹´ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤.
                let cardContentHtml = `
                <div class="row no-gutters">
                    <div class="col-md-3">
                        <img src="${poster}" class="movie-poster"/>
                    </div>
                    <div class="col-md-8">
                        <div class= "card-context">
                            <span class="movie-title">${title}</span><p>
                            <span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes">${likes}</span><p>
                            ëˆ„ì ê´€ê°ìˆ˜ <span class="movie-viewers">${viewers}</span> ëª…<p>
                            ê°œë´‰ì¼ <span class="movie-date">${date}</span>
                        </div>
                    </div>
                </div>
                    `

                // 3. íœ´ì§€í†µì„ ë³´ê³  ìˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ì¹´ë“œì˜ ë²„íŠ¼ì„ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
                let cardFooterHtml = ''
                if (trashMode == false) {
                    cardFooterHtml = `
                        <div class="card-footer">
                            <a href="#" id="movie-button1" onclick="likeMovie('${id}')">
                                ìœ„ë¡œ!
                                <i class="fas fa-thumbs-up"></i>
                            </a>
                            <div></div>
                            <a href="#" id="movie-button2" onclick="trashMovie('${id}')">
                                íœ´ì§€í†µìœ¼ë¡œ
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
            `
                } else {
                    cardFooterHtml = `
                        <div class="card-footer">
                            <a href="#" id="movie-button3" onclick="restoreMovie('${id}')">
                                ë³µêµ¬í•˜ê¸°
                                <i class="fas fa-trash-restore"></i>
                            </a>
                            <div></div>
                            <a href="#" id="movie-button4" onclick="deleteMovie('${id}')">
                                ì˜êµ¬ì‚­ì œ
                                <i class="fas fa-ban"></i>
                            </a>
                        </div>
               `
                }

                // 4. #movie-boxì— ìƒì„±ëœ HTML ì„ ë¶™ì…ë‹ˆë‹¤.
                $('#movie-box').append(`
                    <div class="card">
                        ${cardContentHtml}
                        ${cardFooterHtml}
                    </div>`
                )
            }
        }


        ///////////////////////////////////////////////////////////////////////////////
        // ì£¼ì˜: ì•„ë˜ like movie ëŠ” ì„ì˜ì˜ ì˜í™”ì— ì¢‹ì•„ìš”ê°€ í‘œì‹œë©ë‹ˆë‹¤.
        // ì´ êµ¬í˜„ì„ ì„ íƒí•œ ë¬´ë¹„ì— ì¢‹ì•„ìš”ë¥¼ ë„£ëŠ” ê²ƒìœ¼ë¡œ ìˆ˜ì •í•˜ì…”ì•¼ ë©ë‹ˆë‹¤. (í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ ë° í•¨ìˆ˜ êµ¬í˜„ ëª¨ë‘)    
        function likeMovie(id) {
            $.ajax({
                type: "POST",
                url: "/api/like",
                data: {
                    id_give: id
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        // 2. 'ì¢‹ì•„ìš” ì™„ë£Œ!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                        alert('ì¢‹ì•„ìš” ì™„ë£Œ!')
                        // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                        showMovie()
                    } else {
                        alert('ì¢‹ì•„ìš” ì‹¤íŒ¨ã… ã… ')
                    }
                }
            });
        }

        function trashMovie(id) {
            $.ajax({
                type: "POST",
                url: "/api/trash",
                data: {
                    id_give: id
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        // 2. 'íœ´ì§€í†µ ë³´ë‚´ê¸° ì™„ë£Œ!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                        alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ì™„ë£Œ!')
                        // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                        showMovie()
                    } else {
                        alert('íœ´ì§€í†µ ë³´ë‚´ê¸° ì‹¤íŒ¨')
                    }
                }
            });
        }

        function restoreMovie(id) {
            $.ajax({
                type: "POST",
                url: "/api/restore",
                data: {
                    id_give: id
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        // 2. 'íœ´ì§€í†µì—ì„œ ë³µêµ¬ ì™„ë£Œ!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                        alert('íœ´ì§€í†µì—ì„œ ë³µêµ¬ ì™„ë£Œ!')
                        // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                        showMovie()
                    } else {
                        alert('íœ´ì§€í†µì—ì„œ ë³µêµ¬ ì‹¤íŒ¨')
                    }
                }
            });
        }

        function deleteMovie(id) {
            $.ajax({
                type: "DELETE",
                url: "/api/delete",
                data: {
                    id_give: id
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        // 2. 'ì‚­ì œ ì™„ë£Œ! ì•ˆë…•!' ì–¼ëŸ¿ì„ ë„ì›ë‹ˆë‹¤.
                        alert('ì‚­ì œ ì™„ë£Œ! ì•ˆë…•!')
                        // 3. ë³€ê²½ëœ ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
                        showMovie()
                    } else {
                        alert('ì‚­ì œ ì‹¤íŒ¨')
                    }
                }
            });
        }

        // ì •ë ¬ ê¸°ì¤€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜¸ì¶œë¨
        function changeSorter(newMode) {
            if (sortMode == newMode) {
                return
            }
            sortMode = newMode
            //ë²„íŠ¼ ì´ˆê¸°í™”(ëª¨ë“  ë²„íŠ¼ í† ê¸€ ìƒíƒœ ì œê±°)
            displaySorter()
            
            //ì§€ì •ëœ ë²„íŠ¼ í™œì„±í™”(í† ê¸€ ìƒíƒœ ì ìš©)
            document.getElementById("sorter-"+newMode).classList.toggle("active")
            showMovie()
        }

        // ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼ í•´ë‹¹ ë²„íŠ¼ë§Œ í™œì„±í™” ì‹œí‚¤ê³  ë‹¤ë¥¸ ë²„íŠ¼ì€ ë¹„í™œì„±í™” ì‹œí‚´
        function displaySorter() {
            document.getElementById("sorter-likes").classList.remove("active")
            document.getElementById("sorter-viewers").classList.remove("active")
            document.getElementById("sorter-date").classList.remove("active")
        }

        function displayTrashMode(trashMode) {
            // trashMode ì— ë”°ë¼ "íœ´ì§€í†µ ë³´ê¸°" ë˜ëŠ” "íœ´ì§€í†µ ë‚˜ê°€ê¸°" ê°€ ì¶œë ¥ ë˜ê²Œ êµ¬í˜„í•´ì•¼ ë©ë‹ˆë‹¤.
            if(trashMode == false){
                $('#trash-mode-box').append(`
                    <a herf="#" onclick="change_trashMode()">
                    <i class="fas fa-trash"></i>
                    íœ´ì§€í†µ ë³´ê¸°<a>
                `)
                //trashMode ì „í™˜
                trashMode = true
            }else{
                $('#trash-mode-box').append(`
                    <a herf="#" onclick="change_trashMode()">
                    <i class="fas fa-trash-restore"></i>
                    íœ´ì§€í†µ ë‚˜ê°€ê¸°<a>
                `)
                //trashMode ì „í™˜
                trashMode = false
            }
        }

        function change_trashMode(){
            if(trashMode==false){
                trashMode=true

                showMovie()
                $("#trash-mode-box").empty()
                displayTrashMode(trashMode)
            }else{
                trashMode=false
        
                showMovie()
                $("#trash-mode-box").empty()
                displayTrashMode(trashMode)
            }

        }
    </script>
</head>
<body>
    <!-- ì œëª© ë¶€ë¶„ -->
    <section class="hero is-warning">
        <div class="hero-body">
            <div class="container center">
                <h1 class="title">
                    ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ğŸ˜†
                </h1>
                <h2 class="subtitle">
                    ìˆœìœ„ë¥¼ ë§¤ê²¨ë´…ì‹œë‹¤
                </h2>
            </div>
        </div>
    </section>

    <!-- ì •ë ¬ ì˜µì…˜ ë¶€ë¶„ -->
    <!-- *ì£¼ì˜* ì•„ë˜ ë‚´ìš© ì¤‘ id="sorter-likes", id="sorter-viewers", id="sorter-date" ì€ ì‚­ì œí•˜ë©´ ì•ˆë©ë‹ˆë‹¤. -->
    <div class="mx-auto sorter-box">
        <div class="btn-group m-3 mx-auto w-100">
            <a href="#" class="btn btn-primary" id="sorter-likes" onclick="changeSorter('likes')">ì¢‹ì•„ìš” ìˆœìœ¼ë¡œ ì •ë ¬</a>
            <a href="#" class="btn btn-primary" id="sorter-viewers" onclick="changeSorter('viewers')">ëˆ„ì ê´€ê°ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬</a>
            <a href="#" class="btn btn-primary" id="sorter-date" onclick="changeSorter('date')">ê°œë´‰ì¼ ìˆœìœ¼ë¡œ ì •ë ¬</a>
        </div>
    </div>
    
    <!-- "íœ´ì§€í†µ ë³´ê¸°" ë¶€ë¶„ -->
    <!-- *ì£¼ì˜* ì•„ë˜ ë‚´ìš© ì¤‘ id="trash-mode-box" ì€ ì‚­ì œí•˜ë©´ ì•ˆë©ë‹ˆë‹¤. -->
    <div class="mx-auto sorter-box">
        <span class="d-flex justify-content-end">
            <div id="trash-mode-box">
                <!-- javascript ê°€ ì´ ì‚¬ì´ì— trash mode ì— ë”°ë¼ HTML element ë¥¼ ìƒì„±í•´ì„œ ì‚½ì…í•©ë‹ˆë‹¤. -->
            </div>
        </div>
    </div>

    <!-- ë™ì ìœ¼ë¡œ ì˜í™” ëª©ë¡ì´ ë“¤ì–´ê°ˆ ë¶€ë¶„ -->
    <!-- *ì£¼ì˜* ì•„ë˜ ë‚´ìš© ì¤‘ id="movie-box" ì€ ì‚­ì œí•˜ë©´ ì•ˆë©ë‹ˆë‹¤. -->
    <div class="movie-list" id="movie-box">
        <!-- javascript ê°€ ì´ ì‚¬ì´ì— HTML element ë¥¼ ìƒì„±í•´ì„œ ì‚½ì…í•©ë‹ˆë‹¤. -->
    </div>
</body>
</body>